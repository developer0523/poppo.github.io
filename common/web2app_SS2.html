<!DOCTYPE html>
<!-- AppsFlyer web SDK -->
<html>
  <head>
    <title>AF Test</title>
    <meta charset="utf-8" />
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <link rel="stylesheet" href="../layui/css/layui.css" media="all" />
  </head>

  <body>
    <fieldset
      class="layui-elem-field layui-field-title"
      style="margin-top: 50px"
    >
      <legend>Onelink SmartScript V2</legend>
    </fieldset>
    <div class="layui-tab">
      <ul class="layui-tab-title">
        <li>Google click</li>
        <li>Basic URL</li>
      </ul>
      <div class="layui-tab-content" id="appledown_father">
        <!-- <a id = "appledown" href="index.html">
      <button class="layui-btn"  disabled='true'
      >Download from App Store</button>
      </a> -->

        <br /><br />
        <a id="gpdown" href="index.html">
          <image src="../img/play_store.png"></image>
        </a>
      </div>
    </div>

    <blockquote class="layui-elem-quote" layer-filter>Outgoing URL</blockquote>
    <blockquote class="layui-elem-quote layui-quote-nm" id="outgingurl">
      (Blank)
    </blockquote>
  </body>

  <!-- <script>
    const url = new URL(window.location);
    url.searchParams.set("c", "somewhat");
    url.searchParams.set("pid", "somehow");
    window.history.pushState({}, "", url);
  </script> -->

  <!-- load script for onelink smart script -->
  <script src="../layui/layui.all.js" charset="utf-8"></script>
  <script src="../js/onelink-smart-script-latest.js" charset="utf-8"></script>

  <script type="text/javascript">
    var oneLinkURL = "https://rosea.onelink.me/ovWU";
    const mediaSource = { keys: ["utm_source"], defaultValue: "aftest_from_af" };
    const campaign = { keys: ["utm_campaign"] };
    const adSet = { keys: ["utm_adset"] };
    const ad = { keys: ["utm_ad"] };
    const af_xplatform_vt_lookback = {
      paramKey: "af_xplatform_vt_lookback",
      defaultValue: "12h",
    };
    var crossPlatformFlag = { paramKey: "af_xplatform", keys: [], defaultValue: "true" }
    //Here is a must
     
    var resultURL = window.AF_SMART_SCRIPT.generateOneLinkURL({
      oneLinkURL: oneLinkURL,
      afParameters: {
        mediaSource,
        campaign,
        adSet,
        ad,
        af_xplatform_vt_lookback: af_xplatform_vt_lookback,
        afCustom: [
          crossPlatformFlag
        ] 
      },
    });
    if (resultURL) {
      console.log(resultURL.clickURL);
      setTimeout(() => {
        // window.AF_SMART_SCRIPT.fireImpressionsLink();
        // fetch(resultURL.clickURL);
        // console.log("Impression fired");

        window.AF_SMART_SCRIPT.fireImpressionsLink();
        // FIXME: 请求 400, 后台能看到数据
       }, 1000);
     }
  </script>
</html>
